<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width"
    />
    <title>A-Frame Porsche Rotate</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.x.x/dist/aframe-event-set-component.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <a-asset-item id="chicago" src="jordan1/chicago_black_toe/scene.gltf"></a-asset-item>
        <a-asset-item id="luis" src="jordan1/custom_luis/scene.gltf"></a-asset-item>
        <a-asset-item id="offWhiteChicago" src="jordan1/off_white_chicago/scene.gltf"></a-asset-item>
        <a-asset-item id="offWhiteUnc" src="jordan1/off_white_unc/scene.gltf"></a-asset-item>
        <a-asset-item id="retro" src="jordan1/retro_high_union_la_storm_blue/scene.gltf"></a-asset-item>
        <a-asset-item id="travis" src="jordan1/travis_scott/scene.gltf"></a-asset-item>
      </a-assets>

      <!-- Shoe Section -->
      <a-entity position="-8 0 -20">
        <a-cylinder
          id="triggerCylinder"
          class="clickable"
          position="8 -2 5"
          radius="4"
          height="0.5"
          color="#808080"
        >
          <a-image id="porscheLink" src="#explore" position="-5 -0.1 3" scale="2 1 1" rotation="0 -90 0"></a-image>
        </a-cylinder>

        <!-- Rotating model -->
        <a-entity position="-3 1.5 18">
          <a-entity
            id="shoeModel"
            cursor="rayOrigin: mouse"
            rotation="0 -40 0"
            gltf-model="#chicago"
            position="10 -2 -10"
            scale="20 20 20"
            touch-rotate
          ></a-entity>
        </a-entity>
      </a-entity>

      <!-- Camera with cursor -->
      <a-camera>
        <a-cursor material="color: #FFFFFF; opacity: 0.5; transparent: true"></a-cursor>
      </a-camera>
    </a-scene>

    <!-- Touch Rotate Component -->
    <script>
      AFRAME.registerComponent('touch-rotate', {
        schema: {
          speed: { type: 'number', default: 1 }
        },
        init: function () {
          this.startX = 0;
          this.currentRotation = this.el.getAttribute('rotation').y;
          this.isDragging = false;

          this.handleTouchStart = (e) => {
            this.isDragging = true;
            this.startX = e.touches ? e.touches[0].clientX : e.clientX;
          };

          this.handleTouchMove = (e) => {
            if (!this.isDragging) return;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const deltaX = clientX - this.startX;
            this.startX = clientX;
            this.currentRotation += deltaX * 0.5 * this.data.speed;
            this.el.setAttribute('rotation', `0 ${this.currentRotation} 0`);
          };

          this.handleTouchEnd = () => {
            this.isDragging = false;
          };

          this.el.sceneEl.canvas.addEventListener('touchstart', this.handleTouchStart);
          this.el.sceneEl.canvas.addEventListener('touchmove', this.handleTouchMove);
          this.el.sceneEl.canvas.addEventListener('touchend', this.handleTouchEnd);
          this.el.sceneEl.canvas.addEventListener('mousedown', this.handleTouchStart);
          this.el.sceneEl.canvas.addEventListener('mousemove', this.handleTouchMove);
          this.el.sceneEl.canvas.addEventListener('mouseup', this.handleTouchEnd);
        }
      });
    </script>

    <!-- Link Handling -->
    <script>
      function setupImageLinks() {
        const links = [
          { id: 'gtrLink', url: 'https://www.nissan.ph/vehicles/new/GT-R.html' },
          { id: 'porscheLink', url: 'https://www.porsche.com/usa/models/911/911-gt3-rs/911-gt3-rs/' }
        ];

        links.forEach(link => {
          const element = document.querySelector(`#${link.id}`);
          if (element) {
            element.addEventListener('click', () => window.location.href = link.url);
          }
        });
      }

      window.addEventListener('DOMContentLoaded', setupImageLinks);
    </script>
  </body>
</html>
